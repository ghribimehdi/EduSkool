{% extends 'baseAdmin.html.twig' %}

{% block title %}Gestion des Abonnements{% endblock %}

{% block body %}

  <main class="main">
      <div class="pagetitle">
          <h1>Dashboard</h1>
          <nav>
              <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                  <li class="breadcrumb-item active">Abonnement</li>
              </ol>
          </nav>
      </div>

      <section class="section">
          <div class="row">
              <div class="col-lg-12">
                  <div class="card">
                      <div class="card-body">
                          <h5 class="card-title">Liste des Abonnements</h5>
                          <p>Interface de gestion des abonnements sur la plateforme.</p>

                          <table style="width: 100%; table-layout: fixed;">
                              <thead>
                                  <tr>
                                      <th style="width: 10%;">ID</th>
                                      <th style="width: 20%;">Utilisateur</th>
                                      <th style="width: 20%;">Pack</th>
                                      <th style="width: 15%;">Date Début</th>
                                      <th style="width: 15%;">Date Fin</th>
                                      <th style="width: 10%;">Statut</th>
                                      <th class="text-center" style="width: 10%;">Actions</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  {% for abonnement in abonnements %}
                                      <tr>
                                          <td>{{ abonnement.id }}</td>
                                          <td>{{ abonnement.user.nom }} {{ abonnement.user.prenom }}</td>
                                          <td>{{ abonnement.pack.nom }}</td>
                                          <td>{{ abonnement.dateDebut|date('d/m/Y') }}</td>
                                          <td>{{ abonnement.dateFin|date('d/m/Y') }}</td>
                                          <td>{{ abonnement.statut }}</td>
                                          <td class="text-center">
                                              <form action="{{ path('app_abonnement_delete', {'id': abonnement.id}) }}" method="POST" style="display:inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet abonnement?');">
                                                  <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ abonnement.id) }}">
                                                  <button type="submit" class="btn btn-danger btn-sm">Supprimer</button>
                                              </form>
                                              {% if not abonnement.isApproved %}
                                                  <a href="{{ path('app_backend_abonnement_approve', {'id': abonnement.id}) }}" class="btn btn-success btn-sm">Approuver</a>
                                              {% else %}
                                                  <span class="text-success">Approuvé</span>
                                              {% endif %}
                                          </td>
                                      </tr>
                                  {% endfor %}
                              </tbody>
                          </table>
                      </div>
                  </div>
              </div>
          </div>
      </section>
  </main>

{% endblock %}