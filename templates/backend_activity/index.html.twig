{% extends 'baseAdmin.html.twig' %}

{% block title %}Hello BackendActivityController!{% endblock %}

{% block body %}
<main class="main">
  <div class="pagetitle">
    <h1>Dashboard</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item active">Activity</li>
      </ol>
    </nav>
  </div><!-- End Page Title -->


  <section class="section">
    <div class="row">

<!-- Colonne de gauche : Tableau -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Datatables</h5>
            <p>L'admin dispose d'une interface intuitive lui permettant de gérer les activités publiées sur la plateforme.</p>
            <!-- Table with stripped rows dans une div scrollable -->
            <div style="max-height:518px; overflow-y:auto;">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 15%;">ID</th>
                    <th style="width: 15%;">Nom</th>
                    <th style="width: 25%; text-align: center;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for activity in activities %}
                    <tr>
                      <td>{{ activity.id }}</td>
                      <td>{{ activity.titre }}</td>
                      <td class="text-center">
                        <form action="{{ path('app_activity_delete', {'id': activity.id}) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this activity?');">
                          <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ activity.id) }}">
                          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                      </td>
                      <td>
                        <a href="{{ path('backend_showDetails', { id: activity.id }) }}">See more</a>
                      </td>
                      <td>
                        {% if not activity.isApproved %}
                          <a href="{{ path('app_backend_activity_approve', { id: activity.id }) }}" class="btn btn-success">Approuver</a>
                        {% else %}
                          <span class="text-success">Approuvée</span>
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <!-- Fin Table with stripped rows -->
          </div>
        </div>
      </div>
      <!-- Fin colonne de gauche -->





      <!-- Colonne de droite : Graphique + Carte Total Activités -->





      <div class="col-lg-6">
  <!-- Carte joliment designée pour afficher le nombre total d'activités -->
        <div class="col-lg-4">
        <div class="card info-card revenue-card mt-4">
          <div class="filter">
            <a class="icon" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-three-dots"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
              <li class="dropdown-header text-start">
                <h6>Filter</h6>
              </li>
              <li><a class="dropdown-item" href="#">Today</a></li>
              <li><a class="dropdown-item" href="#">This Month</a></li>
              <li><a class="dropdown-item" href="#">This Year</a></li>
            </ul>
          </div>
          <div class="card-body">
            <h5 class="card-title">Activités <span>| Total</span></h5>
            <div class="d-flex align-items-center">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                <i class="bi bi-activity"></i>
              </div>
              <div class="ps-3">
                <h6>{{ activityCount }}</h6>
                <span class="text-success small pt-1 fw-bold">+0%</span>
                <span class="text-muted small pt-2 ps-1">increase</span>
              </div>
            </div>
          </div>
        </div>
        
        </div>
            <!-- Fin Carte Total Activités -->

        
       <!-- Graphique -->
<div class="card">
  <div class="card-body">
    <h5 class="card-title">Reports <span>/Today</span></h5>
    <div id="reportsChart"></div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        new ApexCharts(document.querySelector("#reportsChart"), {
          series: {{ chartSeries|json_encode|raw }}, // utilisation de vos données dynamiques
          chart: {
            type: 'bar',  // passage au graphique en colonnes
            height: 350,
            toolbar: { show: false }
          },
          plotOptions: {
            bar: {
              horizontal: false,
              columnWidth: '55%',
              endingShape: 'rounded'
            }
          },
          dataLabels: { enabled: false },
          stroke: {
            show: true,
            width: 2,
            colors: ['transparent']
          },
          xaxis: {
            categories: {{ chartDates|json_encode|raw }}, // utilisation de vos dates dynamiques
            title: { text: 'Date' }
          },
          yaxis: {
            min: 0,
            forceNiceScale: true,
            title: { text: 'Nombre d\'activités' },
            labels: { formatter: function (value) { return Math.round(value); } }
          },
          fill: {
            opacity: 1
          },
          tooltip: {
            y: {
              formatter: function(val) { return val; }
            }
          }
        }).render();
      });
    </script>
  </div>
</div>
<!-- Fin Graphique -->






      

        
      </div>
      <!-- Fin colonne de droite -->


    </div>
  </section>
</main>
{% endblock %}
